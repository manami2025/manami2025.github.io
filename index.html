<!DOCTYPE html>
<html>
  <head>
    <title>スプレッドシート連携マップ</title>
    <meta charset="utf-8" />
    <style>
      html, body, #map {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #searchInput {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 5;
        background: white;
        padding: 8px;
        border-radius: 4px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body>
    <input type="text" id="searchInput" placeholder="店舗名で検索" />
    <div id="map"></div>

    <script>
      let map;
      const markers = [];

      const categoryColors = {
        "温泉・ケア": "#ff8a65",
        "買う": "#4db6ac",
        "見る": "#9575cd",
        "食べる": "#fdd835",
        "遊ぶ・体験": "#64b5f6",
        "泊まる": "#e57373"
      };

      async function fetchSheetData() {
        const sheetId = "あなたのスプレッドシートID";
        const gid = "0"; // シートのGID（通常は0）
        const url = `https://docs.google.com/spreadsheets/d/FHCb1dzPiDe6cULzTEGrAtAdmnkUc1TmdLUfu7KXX34/values/シート1?key=AIzaSyB07qN_gNdWzJtvprR3qI0qyQ6ol9AOMUk`;
        const response = await fetch(url);
        const text = await response.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        return json.table.rows.map(row => ({
          category: row.c[0]?.v,
          name: row.c[1]?.v,
          lat: parseFloat(row.c[2]?.v),
          lng: parseFloat(row.c[3]?.v)
        }));
      }

      function addMarker(entry) {
        const color = categoryColors[entry.category] || "#9e9e9e";
        const marker = new google.maps.Marker({
          position: { lat: entry.lat, lng: entry.lng },
          map,
          title: entry.name,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 8,
            fillColor: color,
            fillOpacity: 1,
            strokeWeight: 1,
            strokeColor: "#333"
          }
        });

        const infoWindow = new google.maps.InfoWindow({
          content: `<strong>${entry.name}</strong><br>(${entry.category})`
        });

        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });

        markers.push({ marker, name: entry.name });
      }

      function filterMarkers(searchText) {
        markers.forEach(({ marker, name }) => {
          const visible = name.includes(searchText);
          marker.setVisible(visible);
        });
      }

      async function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 35.09647639047312, lng: 132.3470713278045 },
          zoom: 16,
          mapId: "DEMO_MAP_ID" 
        });

        const data = await fetchSheetData();
        data.forEach(addMarker);

        document.getElementById("searchInput").addEventListener("input", (e) => {
          filterMarkers(e.target.value);
        });
      }
    </script>

    <script async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB07qN_gNdWzJtvprR3qI0qyQ6ol9AOMUk&callback=initMap">
    </script>
  </body>
</html>

