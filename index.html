<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>スプレッドシート連携マップ</title>
  <style>
    #map {
      height: 600px;
      width: 100%;
    }
    #searchInput {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 5;
      width: 300px;
    }
  </style>
</head>
<body>
  <input type="text" id="searchInput" placeholder="店舗名を検索">
  <div id="map"></div>
  <script>
    let map;
    let markers = [];
    const categoryColors = {
      '温泉・ケア': 'red',
      '買う': 'blue',
      '見る': 'green',
      '食べる': 'orange',
      '遊ぶ・体験': 'purple',
      '泊まる': 'brown'
    };

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 35.09647639047312, lng: 132.3470713278045 },
        zoom: 16,
        mapTypeControl: false,
        fullscreenControl: false
      });

      fetch("https://sheets.googleapis.com/v4/spreadsheets/1FHCb1dzPiDe6cULzTEGrAtAdmnkUc1TmdLUfu7KXX34/values/%E3%82%B7%E3%83%BC%E3%83%881?key=AIzaSyB07qN_gNdWzJtvprR3qI0qyQ6ol9AOMUkpub?output=tsv")
        .then(response => response.text())
        .then(data => {
          const rows = data.trim().split("\n").slice(1); // ヘッダー除外
          rows.forEach(row => {
            const [category, name, lat, lng] = row.split("\t");
            if (!lat || !lng) return;

            const color = categoryColors[category] || "gray";
            const marker = new google.maps.Marker({
              position: { lat: parseFloat(lat), lng: parseFloat(lng) },
              map,
              icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 8,
                fillColor: color,
                fillOpacity: 1,
                strokeWeight: 1,
                strokeColor: "#000"
              },
              title: name
            });

            const label = new google.maps.InfoWindow({
              content: `<strong>${name}</strong><br>${category}`
            });

            marker.addListener("click", () => {
              label.open(map, marker);
            });

            marker.category = category;
            marker.storeName = name;
            markers.push(marker);
          });
        });

      document.getElementById("searchInput").addEventListener("input", function () {
        const keyword = this.value.trim();
        markers.forEach(marker => {
          const match = marker.storeName.includes(keyword);
          marker.setVisible(match || keyword === "");
        });
      });
    }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAE5sybi3eDWilyCfnTjto8iKzOezd9ivA &callback=initMap">
  </script>
</body>
</html>
